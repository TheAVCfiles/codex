<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AstroTrader Pro | Celestial Market Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        background-color: #05070d;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      const { useEffect, useState } = React;

      const iconProps = (props) => ({
        width: props.size || 18,
        height: props.size || 18,
        stroke: "currentColor",
        fill: "none",
        strokeWidth: 1.5,
        strokeLinecap: "round",
        strokeLinejoin: "round",
        ...props,
      });

      const IconPlay = (props) => (
        <svg viewBox="0 0 24 24" {...iconProps(props)}>
          <polygon points="7 4 19 12 7 20 7 4" />
        </svg>
      );

      const IconPause = (props) => (
        <svg viewBox="0 0 24 24" {...iconProps(props)}>
          <rect x="6" y="4" width="4" height="16" />
          <rect x="14" y="4" width="4" height="16" />
        </svg>
      );

      const IconDownload = (props) => (
        <svg viewBox="0 0 24 24" {...iconProps(props)}>
          <path d="M12 3v14" />
          <path d="M6 11l6 6 6-6" />
          <path d="M5 21h14" />
        </svg>
      );

      const IconTrendingUp = (props) => (
        <svg viewBox="0 0 24 24" {...iconProps(props)}>
          <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" />
          <polyline points="17 6 23 6 23 12" />
        </svg>
      );

      const IconMoon = (props) => (
        <svg viewBox="0 0 24 24" {...iconProps(props)}>
          <path d="M21 12.79A9 9 0 0111.21 3 7 7 0 0015 21a7 7 0 006-8.21z" />
        </svg>
      );

      const IconInfo = (props) => (
        <svg viewBox="0 0 24 24" {...iconProps(props)}>
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="16" x2="12" y2="12" />
          <line x1="12" y1="8" x2="12.01" y2="8" />
        </svg>
      );

      const assetBirthCharts = [
        {
          symbol: "BTC",
          name: "Bitcoin",
          color: "#F7931A",
          birthDate: "2009-01-03T18:15:05Z",
          birthChart: {
            sun: { sign: "Capricorn", degree: 13, house: 10 },
            moon: { sign: "Cancer", degree: 28, house: 4 },
            ascendant: { sign: "Libra", degree: 5 },
          },
          currentPrice: 100,
          priceHistory: [],
        },
        {
          symbol: "ETH",
          name: "Ethereum",
          color: "#627EEA",
          birthDate: "2015-07-30T15:26:13Z",
          birthChart: {
            sun: { sign: "Leo", degree: 7, house: 5 },
            moon: { sign: "Aquarius", degree: 15, house: 11 },
            ascendant: { sign: "Sagittarius", degree: 22 },
          },
          currentPrice: 100,
          priceHistory: [],
        },
        {
          symbol: "SPX",
          name: "S&P 500",
          color: "#00A3E0",
          birthDate: "1957-03-04T09:30:00Z",
          birthChart: {
            sun: { sign: "Pisces", degree: 13, house: 12 },
            moon: { sign: "Taurus", degree: 8, house: 2 },
            ascendant: { sign: "Gemini", degree: 10 },
          },
          currentPrice: 100,
          priceHistory: [],
        },
      ];

      const calculateMoonPhase = (timestamp) => {
        const lunarCycle = 29.53059 * 24 * 60 * 60 * 1000;
        const knownNewMoon = new Date("2000-01-06T18:14:00Z").getTime();
        const phase = ((timestamp - knownNewMoon) % lunarCycle) / lunarCycle;
        return phase < 0 ? phase + 1 : phase;
      };

      const getMoonPhaseName = (phase) => {
        if (phase < 0.03 || phase > 0.97) return "New Moon";
        if (phase < 0.22) return "Waxing Crescent";
        if (phase < 0.28) return "First Quarter";
        if (phase < 0.47) return "Waxing Gibbous";
        if (phase < 0.53) return "Full Moon";
        if (phase < 0.72) return "Waning Gibbous";
        if (phase < 0.78) return "Last Quarter";
        return "Waning Crescent";
      };

      const getMoonPhaseIcon = (phase) => {
        if (phase < 0.03 || phase > 0.97) return "ðŸŒ‘";
        if (phase < 0.22) return "ðŸŒ’";
        if (phase < 0.28) return "ðŸŒ“";
        if (phase < 0.47) return "ðŸŒ”";
        if (phase < 0.53) return "ðŸŒ•";
        if (phase < 0.72) return "ðŸŒ–";
        if (phase < 0.78) return "ðŸŒ—";
        return "ðŸŒ˜";
      };

      const calculateTransits = (asset, currentDate, phaseOverride = null) => {
        const aspects = [];
        const signals = { buy: [], sell: [] };

        const daysSinceBirth =
          (currentDate - new Date(asset.birthDate).getTime()) / (1000 * 60 * 60 * 24);

        const sunTransit = ((daysSinceBirth % 365) / 365) * 360;

        const normalizeAngle = (deg) => {
          const v = deg % 360;
          return v < 0 ? v + 360 : v;
        };
        const diff = (a, b) => {
          const d = Math.abs(normalizeAngle(a) - normalizeAngle(b));
          return d > 180 ? 360 - d : d;
        };

        const orb = diff(sunTransit, asset.birthChart.sun.degree);

        if (orb < 8) {
          aspects.push({ type: "â˜Œ Conjunction", strength: "STRONG" });
          signals.buy.push({
            reason: "Solar Return â€” Annual cycle beginning",
            strength: 0.9,
          });
        }

        if (Math.abs(orb - 120) < 8 || Math.abs(orb - 240) < 8) {
          aspects.push({ type: "â–³ Trine", strength: "MODERATE" });
          signals.buy.push({ reason: "Trine Aspect â€” Favorable momentum", strength: 0.7 });
        }

        if (Math.abs(orb - 90) < 8 || Math.abs(orb - 270) < 8) {
          aspects.push({ type: "â–¡ Square", strength: "STRONG" });
          signals.sell.push({
            reason: "Square Aspect â€” Increased volatility",
            strength: 0.6,
          });
        }

        const phase = phaseOverride ?? calculateMoonPhase(currentDate);

        if (phase < 0.1 || phase > 0.9) {
          signals.buy.push({
            reason: "New Moon Phase â€” Entry window",
            strength: 0.6,
          });
        } else if (phase > 0.45 && phase < 0.55) {
          signals.sell.push({
            reason: "Full Moon Phase â€” Profit-taking zone",
            strength: 0.6,
          });
        }

        return { aspects, signals };
      };

      const AstroTraderPro = () => {
        const [assets, setAssets] = useState(assetBirthCharts);
        const [selectedAsset, setSelectedAsset] = useState(assetBirthCharts[0]);
        const [isPlaying, setIsPlaying] = useState(false);
        const [currentTime, setCurrentTime] = useState(Date.now());
        const [moonPhase, setMoonPhase] = useState(0);
        const [transitAspects, setTransitAspects] = useState([]);
        const [buySignals, setBuySignals] = useState([]);
        const [sellSignals, setSellSignals] = useState([]);
        const [showTutorial, setShowTutorial] = useState(false);

        useEffect(() => {
          if (!isPlaying) return;

          const interval = setInterval(() => {
            setCurrentTime((prev) => {
              const newTime = prev + 1000 * 60 * 60 * 24;
              const phase = calculateMoonPhase(newTime);
              setMoonPhase(phase);

              setAssets((prevAssets) => {
                const updatedAssets = prevAssets.map((asset) => {
                  const { aspects, signals } = calculateTransits(asset, newTime, phase);

                  if (asset.symbol === selectedAsset.symbol) {
                    setTransitAspects(aspects);
                    setBuySignals(signals.buy);
                    setSellSignals(signals.sell);
                  }

                  const bias = signals.buy.length > signals.sell.length ? 2 : -1;
                  const drift = (Math.random() - 0.5 + bias * 0.1) * 5;
                  const newPrice = Math.max(10, asset.currentPrice + drift);

                  return {
                    ...asset,
                    currentPrice: newPrice,
                    priceHistory: [
                      ...asset.priceHistory.slice(-100),
                      { time: newTime, price: newPrice },
                    ],
                  };
                });

                const updatedSelected = updatedAssets.find((a) => a.symbol === selectedAsset.symbol);
                if (updatedSelected) {
                  setSelectedAsset(updatedSelected);
                }

                return updatedAssets;
              });

              return newTime;
            });
          }, 100);

          return () => clearInterval(interval);
        }, [isPlaying, selectedAsset.symbol]);

        useEffect(() => {
          const now = Date.now();
          const phase = calculateMoonPhase(now);
          setMoonPhase(phase);
          const { aspects, signals } = calculateTransits(selectedAsset, now, phase);
          setTransitAspects(aspects);
          setBuySignals(signals.buy);
          setSellSignals(signals.sell);
          setCurrentTime(now);
        }, []);

        const handleExport = () => {
          const exportPayload = {
            asset: selectedAsset.symbol,
            name: selectedAsset.name,
            birthDate: selectedAsset.birthDate,
            birthChart: selectedAsset.birthChart,
            priceHistory: selectedAsset.priceHistory,
            lastUpdate: new Date(currentTime).toISOString(),
            currentMoonPhase: {
              phase: moonPhase,
              name: getMoonPhaseName(moonPhase),
              icon: getMoonPhaseIcon(moonPhase),
            },
            signals: {
              buy: buySignals,
              sell: sellSignals,
            },
          };

          const blob = new Blob([JSON.stringify(exportPayload, null, 2)], {
            type: "application/json",
          });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `astrotrader_${selectedAsset.symbol}_${Date.now()}.json`;
          a.click();
          URL.revokeObjectURL(url);
        };

        return (
          <div className="min-h-screen bg-gradient-to-br from-gray-950 via-slate-900 to-black text-gray-100">
            <div className="max-w-7xl mx-auto px-6 py-8">
              <header className="mb-10 pb-6 border-b border-gray-800">
                <div className="flex items-end justify-between">
                  <div>
                    <h1 className="text-4xl font-light tracking-tight mb-2 text-gray-100">
                      Astro<span className="text-gray-500">Trader</span>
                    </h1>
                    <p className="text-sm text-gray-500 tracking-wide">
                      Celestial market intelligence platform
                    </p>
                  </div>
                  <div className="text-right">
                    <div className="text-xs text-gray-600 uppercase tracking-widest mb-1">
                      Lunar Phase
                    </div>
                    <div className="flex items-center gap-2 text-gray-400">
                      <span className="text-2xl">{getMoonPhaseIcon(moonPhase)}</span>
                      <span className="text-sm font-light">{getMoonPhaseName(moonPhase)}</span>
                    </div>
                  </div>
                </div>
              </header>

              <div className="mb-8 flex items-center justify-between">
                <div className="flex gap-3">
                  <button
                    onClick={() => setIsPlaying((prev) => !prev)}
                    className="flex items-center gap-2 px-5 py-2.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded text-sm font-light tracking-wide transition-all"
                  >
                    {isPlaying ? <IconPause size={16} /> : <IconPlay size={16} />}
                    {isPlaying ? "Pause" : "Initialize"}
                  </button>

                  <button
                    onClick={() => setShowTutorial((prev) => !prev)}
                    className="flex items-center gap-2 px-5 py-2.5 border border-gray-700 rounded text-sm font-light tracking-wide hover:border-gray-600 transition-all"
                  >
                    <IconInfo size={16} />
                    Methodology
                  </button>
                </div>

                <div className="text-xs text-gray-600 tracking-wider">
                  {new Date(currentTime).toLocaleDateString("en-US", {
                    month: "short",
                    day: "numeric",
                    year: "numeric",
                  })}
                </div>
              </div>

              {showTutorial && (
                <div className="mb-8 bg-gray-900 border border-gray-800 rounded-lg p-8">
                  <h2 className="text-xl font-light mb-6 tracking-tight">Signal Interpretation Framework</h2>

                  <div className="grid md:grid-cols-2 gap-8 text-sm">
                    <div>
                      <h3 className="text-xs uppercase tracking-widest text-gray-500 mb-4">
                        Aspect Analysis
                      </h3>
                      <div className="space-y-3 text-gray-400">
                        <div>
                          <span className="font-medium text-gray-300">Conjunction (0Â°)</span>
                          <p className="text-xs mt-1">
                            Cycle initiation. Entry consideration at solar returns.
                          </p>
                        </div>
                        <div>
                          <span className="font-medium text-gray-300">Trine (120Â°)</span>
                          <p className="text-xs mt-1">Favorable momentum. Accumulation phase indicator.</p>
                        </div>
                        <div>
                          <span className="font-medium text-gray-300">Square (90Â°)</span>
                          <p className="text-xs mt-1">
                            Volatility warning. Position sizing adjustment recommended.
                          </p>
                        </div>
                      </div>
                    </div>

                    <div>
                      <h3 className="text-xs uppercase tracking-widest text-gray-500 mb-4">
                        Lunar Cycle Protocol
                      </h3>
                      <div className="space-y-3 text-gray-400">
                        <div>
                          <span className="font-medium text-gray-300">New Moon Phase</span>
                          <p className="text-xs mt-1">Entry window. Initiate positions for waxing phase.</p>
                        </div>
                        <div>
                          <span className="font-medium text-gray-300">Full Moon Phase</span>
                          <p className="text-xs mt-1">Profit-taking zone. Elevated volatility expected.</p>
                        </div>
                        <div>
                          <span className="font-medium text-gray-300">Waning Phase</span>
                          <p className="text-xs mt-1">Consolidation period. Reduced position exposure.</p>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div className="mt-8 pt-6 border-t border-gray-800">
                    <p className="text-xs text-gray-500 leading-relaxed">
                      This platform integrates natal chart analysis with simulated market dynamics. Each asset maintains a birth
                      chart derived from its genesis date, providing a framework for exploring cyclical patterns and temporal
                      correlations. This is for research and educational purposes only, not financial advice.
                    </p>
                  </div>
                </div>
              )}

              <div className="grid lg:grid-cols-4 gap-8">
                <div className="lg:col-span-3 space-y-6">
                  <div className="flex gap-3 pb-4 border-b border-gray-800">
                    {assets.map((asset) => (
                      <button
                        key={asset.symbol}
                        onClick={() => {
                          setSelectedAsset(asset);
                          const phase = calculateMoonPhase(currentTime);
                          const { aspects, signals } = calculateTransits(asset, currentTime, phase);
                          setTransitAspects(aspects);
                          setBuySignals(signals.buy);
                          setSellSignals(signals.sell);
                        }}
                        className={`px-4 py-2 text-sm font-light tracking-wide transition-all ${
                          selectedAsset.symbol === asset.symbol
                            ? "border-b-2 border-gray-400 text-gray-100"
                            : "text-gray-600 hover:text-gray-400"
                        }`}
                      >
                        {asset.symbol}
                      </button>
                    ))}
                  </div>

                  <div className="bg-gray-900 border border-gray-800 rounded-lg p-6">
                    <div className="flex items-center justify-between mb-6">
                      <div>
                        <h2
                          className="text-2xl font-light tracking-tight mb-1"
                          style={{ color: selectedAsset.color }}
                        >
                          {selectedAsset.name}
                        </h2>
                        <p className="text-xs text-gray-600">
                          Genesis:{" "}
                          {new Date(selectedAsset.birthDate).toLocaleDateString("en-US", {
                            month: "short",
                            day: "numeric",
                            year: "numeric",
                          })}
                        </p>
                      </div>
                      <div className="text-right">
                        <div className="text-3xl font-light tracking-tight">
                          {selectedAsset.currentPrice.toFixed(2)}
                        </div>
                        <div className="text-xs text-gray-600 tracking-wider">Current Value</div>
                      </div>
                    </div>

                    <div className="relative h-64 bg-black rounded border border-gray-800">
                      <svg viewBox="0 0 800 200" className="w-full h-full">
                        {[0, 50, 100, 150, 200].map((y) => (
                          <line key={y} x1="0" y1={y} x2="800" y2={y} stroke="#1f2937" strokeWidth="1" />
                        ))}

                        {selectedAsset.priceHistory.length > 1 && (
                          <polyline
                            points={selectedAsset.priceHistory
                              .map((p, i) => {
                                const x = (i / selectedAsset.priceHistory.length) * 800;
                                const y = 200 - ((p.price - 80) / 40) * 200;
                                return `${x},${y}`;
                              })
                              .join(" ")}
                            fill="none"
                            stroke={selectedAsset.color}
                            strokeWidth="2"
                            opacity="0.8"
                          />
                        )}

                        {selectedAsset.priceHistory.map((p, i) => {
                          if (i % 20 === 0 && buySignals.length > 0) {
                            const x = (i / selectedAsset.priceHistory.length) * 800;
                            const y = 200 - ((p.price - 80) / 40) * 200;
                            return <circle key={`buy-${i}`} cx={x} cy={y} r="3" fill="#10b981" opacity="0.6" />;
                          }
                          if (i % 15 === 0 && sellSignals.length > 0) {
                            const x = (i / selectedAsset.priceHistory.length) * 800;
                            const y = 200 - ((p.price - 80) / 40) * 200;
                            return <circle key={`sell-${i}`} cx={x} cy={y} r="3" fill="#ef4444" opacity="0.6" />;
                          }
                          return null;
                        })}
                      </svg>
                    </div>
                  </div>

                  <div className="bg-gray-900 border border-gray-800 rounded-lg p-6">
                    <h3 className="text-sm font-light tracking-wide mb-6 text-gray-400">Natal Configuration</h3>

                    <div className="grid md:grid-cols-2 gap-6">
                      <svg viewBox="0 0 300 300" className="w-full">
                        <circle cx="150" cy="150" r="140" fill="none" stroke="#1f2937" strokeWidth="1" />
                        <circle cx="150" cy="150" r="100" fill="none" stroke="#374151" strokeWidth="1" />

                        {[0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330].map((deg) => {
                          const rad = (deg * Math.PI) / 180;
                          return (
                            <line
                              key={deg}
                              x1="150"
                              y1="150"
                              x2={150 + Math.cos(rad) * 140}
                              y2={150 + Math.sin(rad) * 140}
                              stroke="#1f2937"
                              strokeWidth="0.5"
                              opacity="0.5"
                            />
                          );
                        })}

                        <circle cx="150" cy="30" r="8" fill="#FFD700" opacity="0.8" />
                        <text x="150" y="34" fontSize="12" fill="white" textAnchor="middle">
                          â˜‰
                        </text>

                        <circle cx="250" cy="150" r="6" fill="#C0C0C0" opacity="0.8" />
                        <text x="250" y="154" fontSize="10" fill="white" textAnchor="middle">
                          â˜½
                        </text>
                      </svg>

                      <div className="space-y-4">
                        <div className="pb-3 border-b border-gray-800">
                          <div className="text-xs text-gray-600 uppercase tracking-widest mb-1">â˜‰ Sun</div>
                          <div className="text-sm text-gray-300">
                            {selectedAsset.birthChart.sun.sign} {selectedAsset.birthChart.sun.degree}Â°
                          </div>
                        </div>

                        <div className="pb-3 border-b border-gray-800">
                          <div className="text-xs text-gray-600 uppercase tracking-widest mb-1">â˜½ Moon</div>
                          <div className="text-sm text-gray-300">
                            {selectedAsset.birthChart.moon.sign} {selectedAsset.birthChart.moon.degree}Â°
                          </div>
                        </div>

                        <div>
                          <div className="text-xs text-gray-600 uppercase tracking-widest mb-1">Ascendant</div>
                          <div className="text-sm text-gray-300">
                            {selectedAsset.birthChart.ascendant.sign} {selectedAsset.birthChart.ascendant.degree}Â°
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="space-y-6">
                  <div className="bg-gray-900 border border-gray-800 rounded-lg p-5">
                    <div className="flex items-center gap-2 mb-4">
                      <IconTrendingUp className="w-4 h-4 text-green-500" />
                      <h3 className="text-xs uppercase tracking-widest text-gray-500">Entry Signals</h3>
                    </div>
                    <div className="space-y-3">
                      {buySignals.length === 0 ? (
                        <p className="text-xs text-gray-600">No active signals</p>
                      ) : (
                        buySignals.map((signal, i) => (
                          <div key={i} className="pb-3 border-b border-gray-800 last:border-0 last:pb-0">
                            <div className="text-sm text-gray-300 mb-1">{signal.reason}</div>
                            <div className="flex items-center gap-2">
                              <div className="flex-1 h-1 bg-gray-800 rounded-full overflow-hidden">
                                <div
                                  className="h-full bg-green-500"
                                  style={{ width: `${signal.strength * 100}%` }}
                                />
                              </div>
                              <span className="text-xs text-gray-600">{(signal.strength * 100).toFixed(0)}%</span>
                            </div>
                          </div>
                        ))
                      )}
                    </div>
                  </div>

                  <div className="bg-gray-900 border border-gray-800 rounded-lg p-5">
                    <div className="flex items-center gap-2 mb-4">
                      <IconMoon className="w-4 h-4 text-red-500" />
                      <h3 className="text-xs uppercase tracking-widest text-gray-500">Exit Signals</h3>
                    </div>
                    <div className="space-y-3">
                      {sellSignals.length === 0 ? (
                        <p className="text-xs text-gray-600">No active signals</p>
                      ) : (
                        sellSignals.map((signal, i) => (
                          <div key={i} className="pb-3 border-b border-gray-800 last:border-0 last:pb-0">
                            <div className="text-sm text-gray-300 mb-1">{signal.reason}</div>
                            <div className="flex items-center gap-2">
                              <div className="flex-1 h-1 bg-gray-800 rounded-full overflow-hidden">
                                <div
                                  className="h-full bg-red-500"
                                  style={{ width: `${signal.strength * 100}%` }}
                                />
                              </div>
                              <span className="text-xs text-gray-600">{(signal.strength * 100).toFixed(0)}%</span>
                            </div>
                          </div>
                        ))
                      )}
                    </div>
                  </div>

                  {transitAspects.length > 0 && (
                    <div className="bg-gray-900 border border-gray-800 rounded-lg p-5">
                      <h3 className="text-xs uppercase tracking-widest text-gray-500 mb-4">Active Aspects</h3>
                      <div className="space-y-2">
                        {transitAspects.map((aspect, i) => (
                          <div key={i} className="text-xs text-gray-400">
                            {aspect.type} <span className="text-gray-600">({aspect.strength})</span>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              </div>

              <footer className="mt-16 pt-8 border-t border-gray-800">
                <div className="flex items-center justify-between text-xs text-gray-600">
                  <div>
                    <p className="tracking-wider">Â© 2024 AstroTrader Intelligence Platform</p>
                    <p className="mt-1">Celestial correlation analysis for research & education</p>
                  </div>
                  <button
                    onClick={handleExport}
                    className="flex items-center gap-2 hover:text-gray-400 transition-colors"
                  >
                    <IconDownload size={14} />
                    Export Data
                  </button>
                </div>
              </footer>
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<AstroTraderPro />);
    </script>
  </body>
</html>
